<link rel="import" href="/bower_components/paper-card/paper-card.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="/bower_components/paper-swipe/paper-swipe.html">
<link rel="import" href="/bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="icon-classes.html">
<link rel="import" href="date-span.html">


<dom-module id="time-card">
    <template>
        <style include="iron-flex iron-flex-alignment iron-positioning icon-classes">
            :host {
                font-family: sans-serif;
                @apply(--layout-horizontal);
                @apply(--layout-around-justified);
            }

            paper-card {
                padding: 16px;
                color: #444;
                @apply(--layout-flex);
            }

            paper-swipe
            {
                height:150px;
                width: 900px;
                margin: 10px 20px 5px 20px;

            }

            @media (max-width: 993px) {
                paper-swipe {
                    @apply(--layout-flex);
                }
            }

            .icon {
                background-repeat: no-repeat;
                background-size: contain;
                width: 64px;
                height: 64px;
                margin-right: 30px;
            }

            .icon-small {
                background-repeat: no-repeat;
                background-size: contain;
                width: 38px;
                height: 38px;
                margin-right: 10px;
                display: none;
            }

            .date-small
            {
                display: none;
                font-size:14px;
            }

            .stop-name {
                text-transform: uppercase;
                font-weight: 700;
                font-size: 2em;
                margin-right: 20px;
            }

            .date {
                text-align: right;
            }

            .directions {
                font-weight: 700;
                margin-right: 30px;
                width: 100px;
            }

            .stop {
                width: 40px;
            }

            .ellipsis {
                overflow-x: hidden;
                white-space: nowrap;
                text-overflow: ellipsis;
            }

            .mb10 {
                margin-bottom: 10px;
            }

            .underlay
            {
                background-color:cyan;
            }

            @media(max-width: 767px) {
                .icon-small {
                    display: block;
                }
                .icon {
                    display: none;
                }
                .date {
                    display: none;
                }

                .date-small
                {
                    display: block;
                }
            }
        </style>

        <paper-swipe on-tap-underlay="resetAction" on-edge="disableAction" peek-offset="-1000">
            <div underlay class="underlay">
                <paper-ripple></paper-ripple>
                Under-hello !
            </div>
            <paper-card content>
                <paper-ripple></paper-ripple>
                <div class="horizontal layout mb10">
                    <div class$="[[getSmallIcon(referenceData)]]"></div>
                    <div class="stop-name flex-auto ellipsis">[[ referenceData.stop_name ]]</div>
                    <date-span class="date flex-auto" date="[[ update_time ]]"></date-span>
                </div>
                <date-span class="date-small mb10" date="[[ update_time ]]"></date-span>
                <div class="horizontal layout">
                    <div class$="[[getIcon(referenceData)]]"></div>
                    <div class="directions flex-auto vertical layout around-justified">
                        <div class="ellipsis">[[ getNomDirection(referenceData, 0)]]</div>
                        <div class="ellipsis">[[ getNomDirection(referenceData, 1)]]</div>
                    </div>
                    <div class="stop flex-auto vertical layout around-justified">
                        <div class="ellipsis">[[ getTemps(referenceData, 0, 0) ]]</div>
                        <div class="ellipsis">[[ getTemps(referenceData, 1, 0) ]]</div>
                    </div>
                    <div class="stop flex-auto vertical layout around-justified">
                        <div class="ellipsis">[[ getTemps(referenceData, 0, 1) ]]</div>
                        <div class="ellipsis">[[ getTemps(referenceData, 1, 1) ]]</div>
                    </div>
                    <div class="stop flex-auto vertical layout around-justified">
                        <div class="ellipsis">[[ getTemps(referenceData, 0, 2) ]]</div>
                        <div class="ellipsis">[[ getTemps(referenceData, 1, 2) ]]</div>
                    </div>
                </div>
            </paper-card>
        </paper-swipe>

    </template>

    <script>
        Polymer({
            is: "time-card",
            properties:         {
                                    referenceData:
                                    {
                                        type:   Object,
                                        value:  function()
                                                {
                                                    return {stop_name:"TEST"};
                                                }
                                    },
                                    updateTime:
                                    {
                                        type:   String,
                                        value:  new Date().getTime()
                                    }
                                },
            getNomDirection:    function(d, index)
                                {
                                    if  (   this.referenceData
                                        &&  this.referenceData.directions
                                        &&  this.referenceData.directions[index]
                                        &&  this.referenceData.directions[index].value
                                        )
                                    {
                                        return this.referenceData.directions[index].value;
                                    }
                                    else
                                    {
                                        return "x";
                                    }

                                },
            getTemps:           function(data, row, col)
                                {
                                    if  (   data
                                        &&  data.timetable
                                        &&  data.timetable[row]
                                        &&  data.timetable[row].next_stops
                                        &&  data.timetable[row].next_stops[col]
                                        )
                                    {
                                        return data.timetable[row].next_stops[col];
                                    }
                                    else
                                    {
                                        return "x";
                                    }
                                },
            getIcon:            function(data)
                                {
                                    var base_classes = "line-number icon flex-none " ;
                                    var icon = (data && data.line_number) ? "icon-" + data.line_number : "";
                                    return base_classes + icon;
                                },
            getSmallIcon:       function(data)
                                {
                                    var base_classes = "line-number icon-small flex-none " ;
                                    var icon = (data && data.line_number) ? "icon-" + data.line_number : "";
                                    return base_classes + icon;
                                },
            resetAction:        function(ev)
                                {
                                    var target = ev.target;
                                    if (ev.type === 'tap-underlay') {
                                        target = ev.detail.target.target;
                                    }
                                    while (target.localName !== 'paper-swipe') {
                                        target = target.parentElement;
                                    }
                                    target.removeAttribute('disable-swipe');
                                    target.resetPosition();
                                },
            disableAction:      function(ev)
                                {
                                    var target = ev.target;
                                    while (target.localName !== 'paper-swipe'){
                                        target = target.parentElement;
                                    }
                                    target.setAttribute('disable-swipe', true);
                                }

        });
    </script>
</dom-module>
